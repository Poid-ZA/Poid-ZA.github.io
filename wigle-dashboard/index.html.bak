<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WiGLE Dashboard</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0e17;--bg2:#111827;--bg3:#1a2234;--a:#00ff88;--t:#e5e7eb;--t2:#9ca3af;--e:#ef4444;--w:#f59e0b;--s:#10b981}
body{font-family:system-ui,sans-serif;background:var(--bg);color:var(--t);min-height:100vh}
.h{background:var(--bg2);border-bottom:1px solid #2d3748;padding:1rem 2rem;display:flex;align-items:center;gap:0.75rem;font-size:1.25rem;font-weight:600}
.i{width:32px;height:32px;background:linear-gradient(135deg,var(--a),#00ccff);border-radius:8px;display:flex;align-items:center;justify-content:center}
.s{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;padding:1rem 2rem;background:var(--bg2);border-bottom:1px solid #2d3748}
.c{background:var(--bg3);border-radius:12px;padding:1rem 1.5rem;border:1px solid #2d3748}
.l{font-size:0.75rem;color:var(--t2);text-transform:uppercase;margin-bottom:0.5rem}
.v{font-size:1.75rem;font-weight:700;color:var(--a)}
.m{display:grid;grid-template-columns:320px 1fr;height:calc(100vh - 140px)}
.sb{background:var(--bg2);border-right:1px solid #2d3748;padding:1.5rem;overflow-y:auto}
.sc{margin-bottom:2rem}
.st{font-size:0.875rem;font-weight:600;color:var(--t2);text-transform:uppercase;margin-bottom:1rem}
.uz{border:2px dashed #4b5563;border-radius:12px;padding:2rem;text-align:center;cursor:pointer}
.uz:hover{border-color:var(--a);background:#00ff8833}
.ut{font-size:2rem;margin-bottom:0.5rem}
.uh{font-size:0.75rem;color:#6b7280;margin-top:0.5rem}
.fg{margin-bottom:1rem}
.fl{font-size:0.875rem;color:var(--t2);margin-bottom:0.5rem;display:block}
.fs,.fi{width:100%;padding:0.625rem 1rem;background:var(--bg3);border:1px solid #4b5563;border-radius:8px;color:var(--t);font-size:0.875rem}
.fs:focus,.fi:focus{outline:none;border-color:var(--a)}
.btn{padding:0.75rem 1.5rem;border-radius:8px;font-size:0.875rem;font-weight:500;cursor:pointer;border:none}
.bp{background:var(--a);color:var(--bg);width:100%;margin-top:1rem}
.bs{background:var(--bg3);color:var(--t);border:1px solid #4b5563;width:100%}
.nl{max-height:300px;overflow-y:auto}
.ni{padding:0.75rem;background:var(--bg3);border-radius:8px;margin-bottom:0.5rem;cursor:pointer}
.ni:hover{background:#2d3748}
.nn{font-weight:500;margin-bottom:0.25rem}
.nm{font-size:0.75rem;color:var(--t2)}
.sb{display:inline-block;padding:0.125rem 0.5rem;border-radius:4px;font-size:0.625rem;font-weight:600;text-transform:uppercase}
.sb-wpa{background:var(--s);color:#fff}
.sb-wep{background:var(--w);color:#000}
.sb-open{background:var(--e);color:#fff}
.mc{position:relative}
#map{width:100%;height:100%}
.mt{position:absolute;top:1rem;right:1rem;z-index:1000;display:flex;flex-direction:column;gap:0.5rem}
.mb{width:40px;height:40px;background:var(--bg3);border:1px solid #4b5563;border-radius:8px;color:var(--t);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1.25rem}
.mb:hover{background:#2d3748}
.lg{position:absolute;bottom:2rem;left:1rem;z-index:1000;background:var(--bg3);border:1px solid #4b5563;border-radius:8px;padding:1rem}
.lt{font-size:0.75rem;font-weight:600;margin-bottom:0.5rem;color:var(--t2)}
.ld{display:flex;align-items:center;gap:0.5rem;font-size:0.75rem;margin-bottom:0.25rem}
.lc{width:16px;height:16px;border-radius:4px}
.ldg{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(10,14,23,0.9);display:flex;align-items:center;justify-content:center;z-index:9999}
.ls{width:48px;height:48px;border:3px solid #4b5563;border-top-color:var(--a);border-radius:50%;animation:sp 1s linear infinite}
@keyframes sp{to{transform:rotate(360deg)}}
.hd{display:none}
.tc{position:fixed;top:1rem;right:1rem;z-index:10000}
.to{background:var(--bg3);border:1px solid #4b5563;border-radius:8px;padding:1rem 1.5rem;margin-bottom:0.5rem;animation:si 0.3s ease}
.to-su{border-left:3px solid var(--s)}
.to-er{border-left:3px solid var(--e)}
@keyframes si{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
</style>
</head>
<body>
<div id="loading" class="ldg hd"><div class="ls"></div></div>
<div id="toast" class="tc"></div>
<header class="h"><div class="i">W</div><span>WiGLE Dashboard</span></header>
<div class="s">
<div class="c"><div class="l">Total</div><div class="v" id="stat-total">0</div></div>
<div class="c"><div class="l">WPA</div><div class="v" id="stat-wpa">0</div></div>
<div class="c"><div class="l">Open</div><div class="v" id="stat-open">0</div></div>
<div class="c"><div class="l">Locations</div><div class="v" id="stat-locations">0</div></div>
</div>
<div class="m">
<aside class="sb">
<div class="sc">
<div class="st">Import</div>
<div class="uz" id="upload-zone"><div class="ut">+</div><div class="uh">Drop KML/CSV</div></div>
<input type="file" id="file-input" accept=".kml,.csv,.json" hidden>
<button class="btn bp" onclick="loadSampleData()">Load Sample</button>
</div>
<div class="sc">
<div class="st">Filters</div>
<div class="fg"><label class="fl">Security</label><select class="fs" id="filter-security"><option value="all">All</option><option value="WPA">WPA</option><option value="WEP">WEP</option><option value="Open">Open</option></select></div>
<div class="fg"><label class="fl">Signal</label><select class="fs" id="filter-signal"><option value="all">All</option><option value="strong">Strong</option><option value="medium">Medium</option><option value="weak">Weak</option></select></div>
<div class="fg"><label class="fl">SSID</label><input type="text" class="fi" id="filter-ssid" placeholder="Search..."></div>
<button class="btn bs" onclick="applyFilters()">Apply</button>
<button class="btn bs" onclick="clearFilters()" style="margin-top:0.5rem">Clear</button>
</div>
<div class="sc">
<div class="st">Networks (<span id="network-count">0</span>)</div>
<div class="nl" id="network-list"><div style="text-align:center;color:var(--t2);padding:2rem">No data</div></div>
</div>
</aside>
<div class="mc">
<div id="map"></div>
<div class="mt">
<button class="mb" onclick="map.zoomIn()">+</button>
<button class="mb" onclick="map.zoomOut()">-</button>
<button class="mb" onclick="centerMap()">O</button>
</div>
<div class="lg">
<div class="lt">Signal</div>
<div class="ld"><div class="lc" style="background:#f00"></div><span>Strong</span></div>
<div class="ld"><div class="lc" style="background:#ff0"></div><span>Medium</span></div>
<div class="ld"><div class="lc" style="background:#0f0"></div><span>Weak</span></div>
</div>
</div>
</div>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
var map,mL;var nw=[];var fn=[];var sh=true;
function initMap(){map=L.map('map').setView([37.7749,-122.4194],10);L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',{attribution:'OSM',subdomains:'abcd',maxZoom:19}).addTo(map);mL=L.layerGroup().addTo(map);}
function showLoading(){document.getElementById('loading').classList.remove('hd')}
function hideLoading(){document.getElementById('loading').classList.add('hd')}
function showToast(m,t){t=t||'su';var c=document.getElementById('toast');var x=document.createElement('div');x.className='to to-'+t;x.textContent=m;c.appendChild(x);setTimeout(function(){x.remove()},3000);}
var uZ=document.getElementById('upload-zone');var fi=document.getElementById('file-input');
uZ.addEventListener('click',function(){fi.click()});
uZ.addEventListener('dragover',function(e){e.preventDefault();uZ.classList.add('uz')});
uZ.addEventListener('dragleave',function(){uZ.classList.remove('uz')});
uZ.addEventListener('drop',function(e){e.preventDefault();uZ.classList.remove('uz');var f=e.dataTransfer.files[0];if(f)processFile(f)});
fi.addEventListener('change',function(e){var f=e.target.files[0];if(f)processFile(f)});
function processFile(file){showLoading();var r=new FileReader();r.onload=function(e){try{var en=file.name;if(en.endsWith('.json')){nw=JSON.parse(e.target.result)}else if(en.endsWith('.csv')){nw=parseCSV(e.target.result)}else if(en.endsWith('.kml')){nw=parseKML(e.target.result)}fn=nw.slice();updateStats();renderMap();renderNetworkList();showToast('Loaded '+nw.length+' networks')}catch(err){showToast('Error: '+err.message,'er')}hideLoading()};r.readAsText(file);}
function parseCSV(t){var ls=t.split('\n').filter(function(l){return l.trim()});var hs=ls[0].split(',').map(function(h){return h.trim().toLowerCase().replace(/"/g,'')});return ls.slice(1).map(function(l){var vs=l.split(',').map(function(v){return v.trim().replace(/"/g,'')});var o={};hs.forEach(function(h,i){o[h]=vs[i]});return{ssid:o.ssid||o.name||'U',bssid:o.bssid||o.mac||'',lat:parseFloat(o.lat||o.latitude||0),lon:parseFloat(o.lon||o.longitude||0),signal:parseInt(o.rssi||o.signal||-100),channel:parseInt(o.channel||0),security:o.security||o.encryption||'Unknown'}}).filter(function(n){return n.lat&&n.lon})}
function parseKML(xml){var p=new DOMParser();var x=p.parseFromString(xml,'text/xml');var pm=x.getElementsByTagName('Placemark');var r=[];for(var i=0;i<pm.length;i++){var e=pm[i];var d=e.getElementsByTagName('description')[0];if(!d)continue;var ds=d.textContent;if(ds.indexOf('Type: WIFI')===-1)continue;var n=e.getElementsByTagName('name')[0];var ss=n?n.textContent:'U';var c=e.getElementsByTagName('coordinates')[0];if(!c)continue;var pt=c.textContent.trim().split(',');var lon=parseFloat(pt[0]),lat=parseFloat(pt[1]);var sig=-75,bs='',sec='Unknown';var sm=ds.match(/Signal:\s*([-\d.]+)/);if(sm)sig=parseFloat(sm[1]);var bm=ds.match(/Network ID:\s*([0-9A-F:]+)/i);if(bm)bs=bm[1];var sem=ds.match(/Encryption:\s*([^ Time]+)/);if(sem)sec=sem[1].trim();r.push({ssid:ss,bssid:bs,lat:lat,lon:lon,signal:sig,channel:0,security:sec})}return r}
function updateStats(){document.getElementById('stat-total').textContent=fn.length;document.getElementById('stat-wpa').textContent=fn.filter(function(x){return x.security.toLowerCase().indexOf('wpa')!==-1}).length;document.getElementById('stat-open').textContent=fn.filter(function(x){return x.security.toLowerCase().indexOf('open')!==-1||x.security==='None'}).length;var u={};fn.forEach(function(x){u[x.lat+','+x.lon]=true});document.getElementById('stat-locations').textContent=Object.keys(u).length;document.getElementById('network-count').textContent=fn.length}
function renderMap(){mL.clearLayers();if(fn.length===0)return;fn.forEach(function(x){var it=(x.signal+100)/100;it=Math.max(0.1,Math.min(1,it));var c=it>0.5?'#f00':it>0.3?'#ff0':'#0f0';var cm=L.circleMarker([x.lat,x.lon],{radius:8,fillColor:c,fillOpacity:0.6,color:'transparent',weight:0});cm.bindPopup('<b>'+x.ssid+'</b><br>Signal: '+x.signal+' dBm<br>Security: '+x.security);mL.addLayer(cm)});var b=L.latLngBounds(fn.map(function(x){return[x.lat,x.lon]}));map.fitBounds(b,{padding:[50,50]})}
function renderNetworkList(){var l=document.getElementById('network-list');if(fn.length===0){l.innerHTML='<div style="text-align:center;color:var(--t2);padding:2rem">No data</div>';return}l.innerHTML=fn.slice(0,50).map(function(x){var sc=x.security.toLowerCase().indexOf('wpa')!==-1?'sb-wpa':x.security.toLowerCase().indexOf('wep')!==-1?'sb-wep':'sb-open';return'<div class="ni" onclick="focusMap('+x.lat+','+x.lon+')"><div class="nn">'+x.ssid+'</div><div class="nm"><span class="sb '+sc+'">'+x.security+'</span> '+x.signal+' dBm</div></div>'}).join('')}
function focusMap(lat,lon){map.setView([lat,lon],16)}
function centerMap(){if(fn.length>0){var b=L.latLngBounds(fn.map(function(x){return[x.lat,x.lon]}));map.fitBounds(b)}else{map.setView([37.7749,-122.4194],10)}}
function applyFilters(){var sf=document.getElementById('filter-security').value;var sif=document.getElementById('filter-signal').value;var ssf=document.getElementById('filter-ssid').value.toLowerCase();fn=nw.filter(function(x){if(sf!=='all'){if(sf==='WPA'&&x.security.toLowerCase().indexOf('wpa')===-1)return false;if(sf==='WEP'&&x.security.toLowerCase().indexOf('wep')===-1)return false;if(sf==='Open'&&x.security.toLowerCase().indexOf('open')===-1&&x.security!=='None')return false}if(sif!=='all'){if(sif==='strong'&&x.signal<=-70)return false